<!DOCTYPE html>
<html lang="en" class="">
<head>
  <title>Get TikTok Account Location Finder | Full Profile Details</title>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <meta name="description" content="Our TikTok Location Finder helps you discover TikTok account locations by username. Get full profile details, Free, accurate, and easy to use!">
  <meta name="keywords" content="TikTok location finder, معرفة موقع تيك توك, معرفة حساب تيك توك  معرفة موقع حساب تيكتوك, Find TikTok Influencers by Location, Tiktok Location Scraper, بوت تحديد موقع تيك توك, كيف يمكنني تحديد موقع حسابي على تيك توك؟, كيف تعرف صاحب حساب التيك توك؟, كيفية العثور على معلومات حساب TikTok؟, How do I find local TikTok users, How do I find a specific TikTok user, How do I look up an account on TikTok, Find TikTok User ID, Free Tiktok search tool, TikTok User Search Tool, account statistics for any TikTok user, tiktok profile lookup, tiktok lookup, tiktok account search, find TikTok user location, TikTok account location, TikTok username location, FAQ TikTok tool, About TikTok location tool, TikTok geolocation, TikTok user location search, Locate TikTok account by username, TikTok profile location, Free TikTok location finder, How to find TikTok user location, TikTok account details, TikTok stats checker">
  <meta name="author" content="@mo.or__">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href="https://tikip.us/"/>

  <meta property="og:title" content="TikTok Account Location Finder | Full Profile Details & FAQ">
  <meta property="og:description" content="Use our free TikTok Location Finder to get full profile details, including location, by username. Learn more about the tool and find answers in our FAQ.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://tikip.us">
  <meta property="og:image" content="https://tikip.us/favicon.png">
  <meta property="og:site_name" content="TikTok Location Finder">


  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:creator" content="@mo.or__">
  <meta name="twitter:title" content="TikTok Account Location Finder | Full Profile Details & FAQ">
  <meta name="twitter:description" content="Free tool to find TikTok user locations and full profile details by username. Check out our FAQ and learn more about how it works.">
  <meta name="twitter:image" content="https://tikip.us/favicon.png">
  <meta content="Global" name="distribution"/>
  <meta content="General" name="rating"/>
  <meta content="en" http-equiv="content-language"/>
  <meta content="Turkey" name="geo.country"/>
  <meta content="en_US" property="og:locale"/>
  <meta content="en_UK" property="og:locale:alternate"/>
  <meta content="Turkey" name="geo.placename"/>

  <!-- Google Fonts and Tailwind CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Roboto+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="icon" href="/favicon.png" type="image/png">
  
  <!-- Scripts -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-HTPQL6DM82"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-HTPQL6DM82');
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6346556035067219" crossorigin="anonymous"></script>
  <meta name="google-site-verification" content="B3Dexm1A96g9Vj5uQ3LjOOsA-RxFqSwca_G0LrOchB0" />
  <meta name="monetag" content="caa90b8bc2e2b44cb2ca5427c3072138">
  
  <!-- API Config (ensure this file exists or functionality will break) -->
  <script src="api_config.js"></script>

  <!-- JSON-LD Schema -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "name": "TikTok Account Location Finder & FAQ",
    "url": "https://tikip.us/",
    "description": "A free online tool to find TikTok account locations and full profile details by username. Includes an FAQ section for common questions.",
    "creator": {
      "@type": "Person",
      "name": "@mo.or__"
    },
    "potentialAction": {
      "@type": "SearchAction",
      "target": "https://tikip.us/?username={search_term_string}",
      "query-input": "required name=search_term_string"
    }
  }
  </script>
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "SoftwareApplication",
    "name": "TikTok Account Location Finder",
    "applicationCategory": "SocialNetworkAnalysisTool",
    "operatingSystem": "Web",
    "browserRequirements": "Requires a modern web browser with JavaScript enabled.",
    "description": "Free web-based tool to retrieve public TikTok user profile details, including estimated location, bio, follower counts, and video statistics by username. Learn more about the tool and see our FAQ.",
    "url": "https://tikip.us/",
    "author": {
      "@type": "Person",
      "name": "@mo.or__"
    },
    "offers": {
      "@type": "Offer",
      "price": "0",
      "priceCurrency": "USD"
    }
  }
  </script>

  <style>
    /* Custom Styles for 3D effect and aesthetics */
    :root {
        --bg-light: #f0f2f5;
        --bg-dark: #111827;
        --card-light: rgba(255, 255, 255, 0.5);
        --card-dark: rgba(31, 41, 55, 0.5); /* Adjusted for better contrast */
        --border-light: rgba(255, 255, 255, 0.8);
        --border-dark: rgba(255, 255, 255, 0.1);
        --shadow-light: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        --shadow-dark: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        --text-light: #1f2937;
        --text-dark: #e5e7eb;
        --text-secondary-light: #4b5563;
        --text-secondary-dark: #9ca3af;
        --font-sans: 'Inter', sans-serif;
        --font-mono: 'Roboto Mono', monospace;
    }

    html.dark {
        --bg: var(--bg-dark);
        --card-bg: var(--card-dark);
        --border-color: var(--border-dark);
        --shadow-color: var(--shadow-dark);
        --text-primary: var(--text-dark);
        --text-secondary: var(--text-secondary-dark);
    }
    html:not(.dark) {
        --bg: var(--bg-light);
        --card-bg: var(--card-light);
        --border-color: var(--border-light);
        --shadow-color: var(--shadow-light);
        --text-primary: var(--text-light);
        --text-secondary: var(--text-secondary-light);
    }

    body {
        font-family: var(--font-sans);
        background-color: var(--bg);
        color: var(--text-primary);
        transition: background-color 0.3s ease;
        overflow-x: hidden;
    }

    .font-mono {
        font-family: var(--font-mono);
    }

    .glass-card {
        background: var(--card-bg);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        border-radius: 1.5rem; /* 24px */
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-color);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        transform-style: preserve-3d;
    }
    
    .glass-card:hover {
        transform: translateY(-5px) scale(1.01);
        box-shadow: 0 16px 40px 0 rgba(31, 38, 135, 0.2);
    }
    html.dark .glass-card:hover {
        box-shadow: 0 16px 40px 0 rgba(0, 0, 0, 0.5);
    }

    .background-gradient {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background-image: 
            radial-gradient(circle at 15% 15%, #00f2fe 0%, transparent 30%),
            radial-gradient(circle at 85% 85%, #ff0070 0%, transparent 30%),
            radial-gradient(circle at 90% 10%, #6200ea 0%, transparent 30%);
        opacity: 0.25;
        filter: blur(120px);
        transition: opacity 0.5s ease;
    }
    
    html.dark .background-gradient {
      opacity: 0.35;
    }
    
    .btn-3d {
        transform-style: preserve-3d;
        transition: all 0.15s ease-out;
    }
    .btn-3d:hover {
        transform: scale(1.05) translateZ(5px);
    }
    .btn-3d:active {
        transform: scale(0.98) translateZ(2px);
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .loading-spinner {
        animation: spin 1s linear infinite;
    }
    
    .page-content.active {
      display: block;
    }
  </style>

</head>
<body class="antialiased">

  <div class="background-gradient"></div>
  
  <div class="relative min-h-screen w-full flex flex-col items-center p-4 sm:p-6 lg:p-8">
    <div class="flex-grow w-full flex items-center justify-center">
        <div class="container w-full max-w-3xl mx-auto">
    
            <!-- Theme Toggle Button -->
            <button class="theme-toggle absolute top-4 right-4 z-10 p-2 rounded-full text-gray-500 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-700/50 transition-colors duration-200" id="themeToggle" aria-label="Toggle theme">
              <svg id="theme-icon-sun" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
              <svg id="theme-icon-moon" class="h-6 w-6 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
          
            <main class="w-full">
                <!-- Main Search Page -->
                <div class="page-content active" id="main-page">
                  <div class="glass-card p-6 sm:p-10 text-center">
                    
                    <div class="mb-4 text-xl sm:text-2xl font-bold" style="color: var(--text-secondary);">❌🚬 | 🏋‍♀️✅</div>
                    <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold tracking-tight" style="color: var(--text-primary);">
                      TikTok Account <span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-400 to-pink-500">Location Finder</span>
                    </h1>
                    <div class="mt-2 mb-8 text-sm font-medium" style="color: var(--text-secondary);">Created by <a href="https://www.tiktok.com/@mo.or__" target="_blank" rel="noopener" class="font-semibold text-cyan-500 hover:text-pink-500 transition-colors">@_moro.__</a></div>

                    <section aria-labelledby="search-tool-heading" class="max-w-xl mx-auto">
                      <h2 id="search-tool-heading" class="sr-only">TikTok Profile Search Tool</h2>
                      <div class="relative">
                        <input type="text" id="username" placeholder="Enter TikTok username (without @)" required aria-label="TikTok Username Input" class="w-full pl-5 pr-12 py-4 text-base rounded-full bg-white/20 dark:bg-black/20 border border-gray-300 dark:border-gray-600/50 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition-all duration-300 shadow-inner" style="color: var(--text-primary);">
                      </div>
                      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-6">
                        <button id="getResultsBtn" aria-label="Search TikTok profile" class="btn-3d w-full py-4 text-base font-bold text-white rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 shadow-lg">Get Profile Details</button>
                        <button id="supportBtn" aria-label="Support the creator" class="btn-3d w-full py-4 text-base font-bold text-white rounded-full bg-gradient-to-r from-pink-500 to-red-500 hover:from-pink-400 hover:to-red-400 shadow-lg">Support Our Work ❤</button>
                      </div>
                    </section>
                  </div>
                  
                  <div id="result" class="mt-8" aria-live="polite"></div>

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-8">
                    <article class="glass-card p-6" aria-labelledby="about-tool-heading">
                        <h2 id="about-tool-heading" class="text-xl font-bold mb-3" style="color: var(--text-primary);">About This Tool</h2>
                        <p class="text-sm" style="color: var(--text-secondary);">This <strong>TikTok Location Finder</strong> is a free tool designed to help you retrieve complete public TikTok user profiles. With our <strong>TikTok profile lookup</strong> service, you can easily <strong>find TikTok user location</strong> information, along with other <strong>TikTok account details</strong>.</p>
                    </article>

                    <article class="glass-card p-6" aria-labelledby="faq-heading">
                        <h2 id="faq-heading" class="text-xl font-bold mb-3" style="color: var(--text-primary);">FAQ</h2>
                        <p class="text-sm" style="color: var(--text-secondary);"><strong>How does it work?</strong> Our tool fetches publicly available TikTok profile information using the username you provide. This includes data such as their display name, bio, follower counts, and an estimated country or region.</p>
                    </article>

                     <article class="glass-card p-6" aria-labelledby="about-creator-heading">
                        <h2 id="about-creator-heading" class="text-xl font-bold mb-3" style="color: var(--text-primary);">About the Creator</h2>
                        <p class="text-sm" style="color: var(--text-secondary);">I'm Moor, a Graphic Designer & Web Developer with 4+ years of experience. Reach out on <a href="https://www.tiktok.com/@mo.or__" class="font-semibold text-cyan-500 hover:text-pink-500 transition-colors" target="_blank" rel="noopener">TikTok</a>!</p>
                    </article>

                    <article class="glass-card p-6" aria-labelledby="get-involved-heading">
                        <h2 id="get-involved-heading" class="text-xl font-bold mb-3" style="color: var(--text-primary);">Get Involved</h2>
                        <p class="text-sm" style="color: var(--text-secondary);">Enjoy this tool? <a href="https://ko-fi.com/moroccan" class="font-semibold text-cyan-500 hover:text-pink-500 transition-colors" target="_blank" rel="noopener">Support on Ko-fi</a> or <a href="https://www.tiktok.com/@mo.or__" class="font-semibold text-cyan-500 hover:text-pink-500 transition-colors" target="_blank" rel="noopener">Follow on TikTok</a>.</p>
                    </article>
                    
                    <article class="glass-card p-6 md:col-span-2" aria-labelledby="disclaimer-heading">
                        <h2 id="disclaimer-heading" class="text-xl font-bold mb-3" style="color: var(--text-primary);">Disclaimer</h2>
                        <p class="text-sm" style="color: var(--text-secondary);">For educational use only. Respect user privacy and use responsibly. Data is sourced publicly and may not be 100% accurate.</p>
                    </article>
                  </div>
                </div>

                <!-- Other Pages (Contact, About, etc.) -->
                <section class="page-content hidden glass-card p-6 sm:p-10" id="contact-page" aria-labelledby="contact-page-heading">
                  <h1 id="contact-page-heading" class="text-2xl sm:text-3xl font-bold mb-4" style="color: var(--text-primary);">Contact Us</h1>
                  <p class="mb-6" style="color: var(--text-secondary);">Have questions or feedback? Reach out using the form below or contact us directly via <a href="https://www.tiktok.com/@mo.or__" class="font-semibold text-cyan-500 hover:text-pink-500" target="_blank" rel="noopener">TikTok</a>.</p>
                  <form class="space-y-4" id="contact-form">
                    <input type="text" id="contact-name" placeholder="Your Name" required class="w-full px-4 py-3 rounded-lg bg-white/20 dark:bg-black/20 border border-gray-300 dark:border-gray-600/50 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition-all" style="color: var(--text-primary);">
                    <input type="email" id="contact-email" placeholder="Your Email" required class="w-full px-4 py-3 rounded-lg bg-white/20 dark:bg-black/20 border border-gray-300 dark:border-gray-600/50 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition-all" style="color: var(--text-primary);">
                    <textarea id="contact-message" placeholder="Your Message" required rows="4" class="w-full px-4 py-3 rounded-lg bg-white/20 dark:bg-black/20 border border-gray-300 dark:border-gray-600/50 focus:ring-2 focus:ring-cyan-400 focus:border-cyan-400 outline-none transition-all" style="color: var(--text-primary);"></textarea>
                    <button type="submit" class="btn-3d w-full py-3 font-bold text-white rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 shadow-lg">Send Message</button>
                  </form>
                   <button class="back-btn mt-4 w-full py-3 font-bold text-white rounded-full bg-gray-500 hover:bg-gray-600 transition-colors" onclick="showPage('main-page')">Back to Home</button>
                </section>
                
                <section class="page-content hidden glass-card p-6 sm:p-10" id="about-page" aria-labelledby="about-us-page-heading">
                   <h1 id="about-us-page-heading" class="text-2xl sm:text-3xl font-bold mb-4" style="color: var(--text-primary);">About Us</h1>
                   <div class="space-y-4" style="color: var(--text-secondary);">
                        <p>Welcome to the TikTok Account Location Finder, a free tool created by <a href="https://www.tiktok.com/@mo.or__" class="font-semibold text-cyan-500 hover:text-pink-500" target="_blank" rel="noopener">@_moro.__</a>.</p>
                        <p>Our mission is to provide a user-friendly platform for researchers, marketers, and social media enthusiasts to access public TikTok profile data. This tool is designed with simplicity, accessibility, and responsiveness in mind, ensuring it works seamlessly across all devices.</p>
                        <p>Built by Moor, a passionate Graphic Designer and Web Developer with over 4 years of experience, this project reflects a commitment to creating innovative tools for the community. Follow us on <a href="https://www.tiktok.com/@mo.or__" class="font-semibold text-cyan-500 hover:text-pink-500" target="_blank" rel="noopener">TikTok</a> for updates and more!</p>
                   </div>
                   <button class="back-btn mt-6 w-full py-3 font-bold text-white rounded-full bg-gray-500 hover:bg-gray-600 transition-colors" onclick="showPage('main-page')">Back to Home</button>
                </section>
                
                <section class="page-content hidden glass-card p-6 sm:p-10" id="privacy-page" aria-labelledby="privacy-policy-page-heading">
                    <h1 id="privacy-policy-page-heading" class="text-2xl sm:text-3xl font-bold mb-4" style="color: var(--text-primary);">Privacy Policy</h1>
                    <div class="space-y-4 text-sm" style="color: var(--text-secondary);">
                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">1. Introduction</h2>
                        <p>We value your privacy and are committed to protecting your personal information. This Privacy Policy explains how we collect, use, and safeguard your data when you use the TikTok Account Location Finder.</p>

                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">2. Information We Collect</h2>
                        <p>We do not collect personal information unless you voluntarily provide it (e.g., via the contact form). The tool fetches publicly available TikTok profile data, which may include usernames, bios, follower counts, and other public metrics.</p>

                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">3. How We Use Your Information</h2>
                        <p>Any information provided through the contact form (e.g., name, email, message) is used solely to respond to your inquiries. Public TikTok data is retrieved and displayed for informational purposes only.</p>
                        
                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">4. Data Sharing</h2>
                        <p>We do not sell, trade, or share your personal information with third parties, except as required by law. Public TikTok data is sourced via a third-party API and is not stored by us.</p>
                    </div>
                    <button class="back-btn mt-6 w-full py-3 font-bold text-white rounded-full bg-gray-500 hover:bg-gray-600 transition-colors" onclick="showPage('main-page')">Back to Home</button>
                </section>
                
                <section class="page-content hidden glass-card p-6 sm:p-10" id="terms-page" aria-labelledby="terms-of-service-page-heading">
                  <h1 id="terms-of-service-page-heading" class="text-2xl sm:text-3xl font-bold mb-4" style="color: var(--text-primary);">Terms of Service</h1>
                  <div class="space-y-4 text-sm" style="color: var(--text-secondary);">
                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">1. Acceptance of Terms</h2>
                        <p>By using the TikTok Account Location Finder, you agree to these Terms of Service. If you do not agree, please do not use the tool.</p>

                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">2. Use of the Tool</h2>
                        <p>This tool is for educational and research purposes only. You agree to use it responsibly and respect the privacy of others. Do not use the tool for illegal activities or to harm others.</p>

                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">3. Data Accuracy</h2>
                        <p>The tool fetches publicly available TikTok data via a third-party API. We do not guarantee the accuracy or completeness of the data provided.</p>
                        
                        <h2 class="text-xl font-semibold" style="color: var(--text-primary);">4. Limitation of Liability</h2>
                        <p>We are not liable for any damages arising from the use of this tool. Use it at your own risk.</p>
                  </div>
                  <button class="back-btn mt-6 w-full py-3 font-bold text-white rounded-full bg-gray-500 hover:bg-gray-600 transition-colors" onclick="showPage('main-page')">Back to Home</button>
                </section>

            </main>

            <footer class="footer mt-12 text-center py-6">
                <nav class="footer-nav flex flex-wrap justify-center gap-x-6 gap-y-2" aria-label="Footer navigation">
                  <a href="#" onclick="showPage('main-page'); return false;" class="text-sm font-medium hover:text-cyan-400 transition-colors" style="color: var(--text-secondary);">Home</a>
                  <a href="#" onclick="showPage('about-page'); return false;" class="text-sm font-medium hover:text-cyan-400 transition-colors" style="color: var(--text-secondary);">About Us</a>
                  <a href="#" onclick="showPage('contact-page'); return false;" class="text-sm font-medium hover:text-cyan-400 transition-colors" style="color: var(--text-secondary);">Contact</a>
                  <a href="#" onclick="showPage('privacy-page'); return false;" class="text-sm font-medium hover:text-cyan-400 transition-colors" style="color: var(--text-secondary);">Privacy</a>
                  <a href="#" onclick="showPage('terms-page'); return false;" class="text-sm font-medium hover:text-cyan-400 transition-colors" style="color: var(--text-secondary);">Terms</a>
                </nav>
            </footer>
        </div>
    </div>
  </div>

  <script>
    // ===== THEME TOGGLE FUNCTIONALITY ===== //
    const themeToggle = document.getElementById('themeToggle');
    const sunIcon = document.getElementById('theme-icon-sun');
    const moonIcon = document.getElementById('theme-icon-moon');
    const htmlEl = document.documentElement;

    const currentTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
    htmlEl.classList.toggle('dark', currentTheme === 'dark');
    sunIcon.classList.toggle('hidden', currentTheme === 'dark');
    moonIcon.classList.toggle('hidden', currentTheme !== 'dark');

    themeToggle.addEventListener('click', () => {
        htmlEl.classList.toggle('dark');
        const isDark = htmlEl.classList.contains('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        sunIcon.classList.toggle('hidden', isDark);
        moonIcon.classList.toggle('hidden', !isDark);
    });
    
    // ===== PAGE NAVIGATION LOGIC ===== //
    const baseTitle = "TikTok Account Location Finder | Full Profile Details & FAQ";
    function showPage(pageId) {
      document.querySelectorAll('.page-content').forEach(page => {
          page.classList.remove('active');
          page.classList.add('hidden');
      });
      const targetPage = document.getElementById(pageId);
      if (targetPage) {
        targetPage.classList.add('active');
        targetPage.classList.remove('hidden');
        const pageTitleElement = targetPage.querySelector('h1');
        document.title = (pageTitleElement && pageId !== 'main-page') ? `${pageTitleElement.textContent} | TikTok Account Location Finder` : baseTitle;
      }
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    // Handle Contact Form
    const contactForm = document.getElementById('contact-form');
    if(contactForm) {
        contactForm.addEventListener('submit', (e) => {
            e.preventDefault();
            // In a real app, you'd send this data to a server.
            // For this demo, we'll just show a success message and clear the form.
            alert('Thank you for your message! We will get back to you soon.');
            contactForm.reset();
        });
    }

    // ===== API & USER LOOKUP LOGIC ===== //
    function getCountryFlag(country) {
      const flagMap = {
        'AD': '🇦🇩', 'Andorra': '🇦🇩', 'AE': '🇦🇪', 'United Arab Emirates': '🇦🇪', 'AF': '🇦🇫', 'Afghanistan': '🇦🇫',
        'AG': '🇦🇬', 'Antigua and Barbuda': '🇦�', 'AI': '🇦🇮', 'Anguilla': '🇦🇮', 'AL': '🇦🇱', 'Albania': '🇦🇱',
        'AM': '🇦🇲', 'Armenia': '🇦🇲', 'AO': '🇦🇴', 'Angola': '🇦🇴', 'AQ': '🇦🇶', 'Antarctica': '🇦🇶',
        'AR': '🇦🇷', 'Argentina': '🇦🇷', 'AS': '🇦🇸', 'American Samoa': '🇦🇸', 'AT': '🇦🇹', 'Austria': '🇦🇹',
        'AU': '🇦🇺', 'Australia': '🇦🇺', 'AW': '🇦🇼', 'Aruba': '🇦🇼', 'AX': '🇦🇽', 'Åland Islands': '🇦🇽',
        'AZ': '🇦🇿', 'Azerbaijan': '🇦🇿', 'BA': '🇧🇦', 'Bosnia and Herzegovina': '🇧🇦', 'BB': '🇧🇧', 'Barbados': '🇧🇧',
        'BD': '🇧🇩', 'Bangladesh': '🇧🇩', 'BE': '🇧🇪', 'Belgium': '🇧🇪', 'BF': '🇧🇫', 'Burkina Faso': '🇧🇫',
        'BG': '🇧🇬', 'Bulgaria': '🇧🇬', 'BH': '🇧🇭', 'Bahrain': '🇧🇭', 'BI': '🇧🇮', 'Burundi': '🇧🇮',
        'BJ': '🇧🇯', 'Benin': '🇧🇯', 'BL': '🇧🇱', 'Saint Barthélemy': '🇧🇱', 'BM': '🇧🇲', 'Bermuda': '🇧🇲',
        'BN': '🇧🇳', 'Brunei Darussalam': '🇧🇳', 'BO': '🇧🇴', 'Bolivia': '🇧🇴', 'BQ': '🇧🇶', 'Bonaire, Sint Eustatius and Saba': '🇧🇶',
        'BR': '🇧🇷', 'Brazil': '🇧🇷', 'BS': '🇧🇸', 'Bahamas': '🇧🇸', 'BT': '🇧🇹', 'Bhutan': '🇧🇹',
        'BV': '🇧🇻', 'Bouvet Island': '🇧🇻', 'BW': '🇧🇼', 'Botswana': '🇧🇼', 'BY': '🇧🇾', 'Belarus': '🇧🇾',
        'BZ': '🇧🇿', 'Belize': '🇧🇿', 'CA': '🇨🇦', 'Canada': '🇨🇦', 'CC': '🇨🇨', 'Cocos (Keeling) Islands': '🇨🇨',
        'CD': '🇨🇩', 'Congo, Democratic Republic of the': '🇨🇩', 'CF': '🇨🇫', 'Central African Republic': '🇨🇫', 'CG': '🇨🇬', 'Congo, Republic of the': '🇨🇬',
        'CH': '🇨🇭', 'Switzerland': '🇨🇭', 'CI': '🇨🇮', "Côte D'Ivoire": '🇨🇮', 'CK': '🇨🇰', 'Cook Islands': '🇨🇰',
        'CL': '🇨🇱', 'Chile': '🇨🇱', 'CM': '🇨🇲', 'Cameroon': '🇨🇲', 'CN': '🇨🇳', 'China': '🇨🇳',
        'CO': '🇨🇴', 'Colombia': '🇨🇴', 'CR': '🇨🇷', 'Costa Rica': '🇨🇷', 'CU': '🇨🇺', 'Cuba': '🇨🇺',
        'CV': '🇨🇻', 'Cape Verde': '🇨🇻', 'CW': '🇨🇼', 'Curaçao': '🇨🇼', 'CX': '🇨🇽', 'Christmas Island': '🇨🇽',
        'CY': '🇨🇾', 'Cyprus': '🇨🇾', 'CZ': '🇨🇿', 'Czech Republic': '🇨🇿', 'DE': '🇩🇪', 'Germany': '🇩🇪',
        'DJ': '🇩🇯', 'Djibouti': '🇩🇯', 'DK': '🇩🇰', 'Denmark': '🇩🇰', 'DM': '🇩🇲', 'Dominica': '🇩🇲',
        'DO': '🇩🇴', 'Dominican Republic': '🇩🇴', 'DZ': '🇩🇿', 'Algeria': '🇩🇿', 'EC': '🇪🇨', 'Ecuador': '🇪🇨',
        'EE': '🇪🇪', 'Estonia': '🇪🇪', 'EG': '🇪🇬', 'Egypt': '🇪🇬', 'EH': '🇪🇭', 'Western Sahara': '🇪🇭',
        'ER': '🇪🇷', 'Eritrea': '🇪🇷', 'ES': '🇪🇸', 'Spain': '🇪🇸', 'ET': '🇪🇹', 'Ethiopia': '🇪🇹',
        'FI': '🇫🇮', 'Finland': '🇫🇮', 'FJ': '🇫🇯', 'Fiji': '🇫🇯', 'FK': '🇫🇰', 'Falkland Islands (Malvinas)': '🇫🇰',
        'FM': '🇫🇲', 'Micronesia, Federated States of': '🇫🇲', 'FO': '🇫🇴', 'Faroe Islands': '🇫🇴', 'FR': '🇫🇷', 'France': '🇫🇷',
        'GA': '🇬🇦', 'Gabon': '🇬🇦', 'GB': '🇬🇧', 'United Kingdom': '🇬🇧', 'UK': '🇬🇧', 'GD': '🇬🇩', 'Grenada': '🇬🇩',
        'GE': '🇬🇪', 'Georgia': '🇬🇪', 'GF': '🇬🇫', 'French Guiana': '🇬🇫', 'GG': '🇬🇬', 'Guernsey': '🇬🇬',
        'GH': '🇬🇭', 'Ghana': '🇬🇭', 'GI': '🇬🇮', 'Gibraltar': '🇬🇮', 'GL': '🇬🇱', 'Greenland': '🇬🇱',
        'GM': '🇬🇲', 'Gambia': '🇬🇲', 'GN': '🇬🇳', 'Guinea': '🇬🇳', 'GP': '🇬🇵', 'Guadeloupe': '🇬🇵',
        'GQ': '🇬🇶', 'Equatorial Guinea': '🇬🇶', 'GR': '🇬🇷', 'Greece': '🇬🇷', 'GS': '🇬🇸', 'South Georgia and the South Sandwich Islands': '🇬🇸',
        'GT': '🇬🇹', 'Guatemala': '🇬🇹', 'GU': '🇬🇺', 'Guam': '🇬🇺', 'GW': '🇬🇼', 'Guinea-Bissau': '🇬🇼',
        'GY': '🇬🇾', 'Guyana': '🇬🇾', 'HK': '🇭🇰', 'Hong Kong': '🇭🇰', 'HM': '🇭🇲', 'Heard Island and McDonald Islands': '🇭🇲',
        'HN': '🇭🇳', 'Honduras': '🇭🇳', 'HR': '🇭🇷', 'Croatia': '🇭🇷', 'HT': '🇭🇹', 'Haiti': '🇭🇹',
        'HU': '🇭🇺', 'Hungary': '🇭🇺', 'ID': '🇮🇩', 'Indonesia': '🇮🇩', 'IE': '🇮🇪', 'Ireland': '🇮🇪',
        'IL': '🇮🇱', 'Israel': '🇮🇱', 'IM': '🇮🇲', 'Isle of Man': '🇮🇲', 'IN': '🇮🇳', 'India': '🇮🇳',
        'IO': '🇮🇴', 'British Indian Ocean Territory': '🇮🇴', 'IQ': '🇮🇶', 'Iraq': '🇮🇶', 'IR': '🇮🇷', 'Iran, Islamic Republic of': '🇮🇷',
        'IS': '🇮🇸', 'Iceland': '🇮🇸', 'IT': '🇮🇹', 'Italy': '🇮🇹', 'JE': '🇯🇪', 'Jersey': '🇯🇪',
        'JM': '🇯🇲', 'Jamaica': '🇯🇲', 'JO': '🇯🇴', 'Jordan': '🇯🇴', 'JP': '🇯🇵', 'Japan': '🇯🇵', 'KE': '🇰🇪', 'Kenya': '🇰🇪',
        'KG': '🇰🇬', 'Kyrgyzstan': '🇰🇬', 'KH': '🇰🇭', 'Cambodia': '🇰🇭', 'KI': '🇰🇮', 'Kiribati': '🇰🇮',
        'KM': '🇰🇲', 'Comoros': '🇰🇲', 'KN': '🇰🇳', 'Saint Kitts and Nevis': '🇰🇳', 'KP': '🇰🇵', "Korea, Democratic People's Republic of": '🇰🇵',
        'KR': '🇰🇷', 'Korea, Republic of': '🇰🇷', 'KW': '🇰🇼', 'Kuwait': '🇰🇼', 'KY': '🇰🇾', 'Cayman Islands': '🇰🇾',
        'KZ': '🇰🇿', 'Kazakhstan': '🇰🇿', 'LA': '🇱🇦', "Lao People's Democratic Republic": '🇱🇦', 'LB': '🇱🇧', 'Lebanon': '🇱🇧',
        'LC': '🇱🇨', 'Saint Lucia': '🇱🇨', 'LI': '🇱🇮', 'Liechtenstein': '🇱🇮', 'LK': '🇱🇰', 'Sri Lanka': '🇱🇰',
        'LR': '🇱🇷', 'Liberia': '🇱🇷', 'LS': '🇱🇸', 'Lesotho': '🇱🇸', 'LT': '🇱🇹', 'Lithuania': '🇱🇹',
        'LU': '🇱🇺', 'Luxembourg': '🇱🇺', 'LV': '🇱🇻', 'Latvia': '🇱🇻', 'LY': '🇱🇾', 'Libya': '🇱🇾',
        'MA': '🇲🇦', 'Morocco': '🇲🇦', 'MC': '🇲🇨', 'Monaco': '🇲🇨', 'MD': '🇲🇩', 'Moldova, Republic of': '🇲🇩',
        'ME': '🇲🇪', 'Montenegro': '🇲🇪', 'MF': '🇲🇫', 'Saint Martin (French part)': '🇲🇫', 'MG': '🇲🇬', 'Madagascar': '🇲🇬',
        'MH': '🇲🇭', 'Marshall Islands': '🇲🇭', 'MK': '🇲🇰', 'North Macedonia': '🇲🇰', 'ML': '🇲🇱', 'Mali': '🇲🇱',
        'MM': '🇲🇲', 'Myanmar': '🇲🇲', 'MN': '🇲🇳', 'Mongolia': '🇲🇳', 'MO': '🇲🇴', 'Macao': '🇲🇴',
        'MP': '🇲🇵', 'Northern Mariana Islands': '🇲🇵', 'MQ': '🇲🇶', 'Martinique': '🇲🇶', 'MR': '🇲🇷', 'Mauritania': '🇲🇷',
        'MS': '🇲🇸', 'Montserrat': '🇲🇸', 'MT': '🇲🇹', 'Malta': '🇲🇹', 'MU': '🇲🇺', 'Mauritius': '🇲🇺',
        'MV': '🇲🇻', 'Maldives': '🇲🇻', 'MW': '🇲🇼', 'Malawi': '🇲🇼', 'MX': '🇲🇽', 'Mexico': '🇲🇽',
        'MY': '🇲🇾', 'Malaysia': '🇲🇾', 'MZ': '🇲🇿', 'Mozambique': '🇲🇿', 'NA': '🇳🇦', 'Namibia': '🇳🇦',
        'NC': '🇳🇨', 'New Caledonia': '🇳🇨', 'NE': '🇳🇪', 'Niger': '🇳🇪', 'NF': '🇳🇫', 'Norfolk Island': '🇳🇫',
        'NG': '🇳🇬', 'Nigeria': '🇳🇬', 'NI': '🇳🇮', 'Nicaragua': '🇳🇮', 'NL': '🇳🇱', 'Netherlands': '🇳🇱',
        'NO': '🇳🇴', 'Norway': '🇳🇴', 'NP': '🇳🇵', 'Nepal': '🇳🇵', 'NR': '🇳🇷', 'Nauru': '🇳🇷',
        'NU': '🇳🇺', 'Niue': '🇳🇺', 'NZ': '🇳🇿', 'New Zealand': '🇳🇿', 'OM': '🇴🇲', 'Oman': '🇴🇲',
        'PA': '🇵🇦', 'Panama': '🇵🇦', 'PE': '🇵🇪', 'Peru': '🇵🇪', 'PF': '🇵🇫', 'French Polynesia': '🇵🇫',
        'PG': '🇵🇬', 'Papua New Guinea': '🇵🇬', 'PH': '🇵🇭', 'Philippines': '🇵🇭', 'PK': '🇵🇰', 'Pakistan': '🇵🇰',
        'PL': '🇵🇱', 'Poland': '🇵🇱', 'PM': '🇵🇲', 'Saint Pierre and Miquelon': '🇵🇲', 'PN': '🇵🇳', 'Pitcairn': '🇵🇳',
        'PR': '🇵🇷', 'Puerto Rico': '🇵🇷', 'PS': '🇵🇸', 'Palestine, State of': '🇵🇸', 'PT': '🇵🇹', 'Portugal': '🇵🇹',
        'PW': '🇵🇼', 'Palau': '🇵🇼', 'PY': '🇵🇾', 'Paraguay': '🇵🇾', 'QA': '🇶🇦', 'Qatar': '🇶🇦',
        'RE': '🇷🇪', 'Réunion': '🇷🇪', 'RO': '🇷🇴', 'Romania': '🇷🇴', 'RS': '🇷🇸', 'Serbia': '🇷🇸',
        'RU': '🇷🇺', 'Russian Federation': '🇷🇺', 'Russia': '🇷🇺', 'RW': '🇷🇼', 'Rwanda': '🇷🇼', 'SA': '🇸🇦', 'Saudi Arabia': '🇸🇦',
        'SB': '🇸🇧', 'Solomon Islands': '🇸🇧', 'SC': '🇸🇨', 'Seychelles': '🇸🇨', 'SD': '🇸🇩', 'Sudan': '🇸🇩',
        'SE': '🇸🇪', 'Sweden': '🇸🇪', 'SG': '🇸🇬', 'Singapore': '🇸🇬', 'SH': '🇸🇭', 'Saint Helena, Ascension and Tristan da Cunha': '🇸🇭',
        'SI': '🇸🇮', 'Slovenia': '🇸🇮', 'SJ': '🇸🇯', 'Svalbard and Jan Mayen': '🇸🇯', 'SK': '🇸🇰', 'Slovakia': '🇸🇰',
        'SL': '🇸🇱', 'Sierra Leone': '🇸🇱', 'SM': '🇸🇲', 'San Marino': '🇸🇲', 'SN': '🇸🇳', 'Senegal': '🇸🇳',
        'SO': '🇸🇴', 'Somalia': '🇸🇴', 'SR': '🇸🇷', 'Suriname': '🇸🇷', 'SS': '🇸🇸', 'South Sudan': '🇸🇸',
        'ST': '🇸🇹', 'Sao Tome and Principe': '🇸🇹', 'SV': '🇸🇻', 'El Salvador': '🇸🇻', 'SX': '🇸🇽', 'Sint Maarten (Dutch part)': '🇸🇽',
        'SY': '🇸🇾', 'Syrian Arab Republic': '🇸🇾', 'SZ': '🇸🇿', 'Eswatini': '🇸🇿', 'TC': '🇹🇨', 'Turks and Caicos Islands': '🇹🇨',
        'TD': '🇹🇩', 'Chad': '🇹🇩', 'TF': '🇹🇫', 'French Southern Territories': '🇹🇫', 'TG': '🇹🇬', 'Togo': '🇹🇬',
        'TH': '🇹🇭', 'Thailand': '🇹🇭', 'TJ': '🇹🇯', 'Tajikistan': '🇹🇯', 'TK': '🇹🇰', 'Tokelau': '🇹🇰',
        'TL': '🇹🇱', 'Timor-Leste': '🇹🇱', 'TM': '🇹🇲', 'Turkmenistan': '🇹🇲', 'TN': '🇹🇳', 'Tunisia': '🇹🇳',
        'TO': '🇹🇴', 'Tonga': '🇹🇴', 'TR': '🇹🇷', 'Turkey': '🇹🇷', 'TT': '🇹🇹', 'Trinidad and Tobago': '🇹🇹',
        'TV': '🇹🇻', 'Tuvalu': '🇹🇻', 'TW': '🇹🇼', 'Taiwan, Province of China': '🇹🇼', 'TZ': '🇹🇿', 'Tanzania, United Republic of': '🇹🇿',
        'UA': '🇺🇦', 'Ukraine': '🇺🇦', 'UG': '🇺🇬', 'Uganda': '🇺🇬', 'UM': '🇺🇲', 'United States Minor Outlying Islands': '🇺🇲',
        'US': '🇺🇸', 'United States of America': '🇺🇸', 'USA': '🇺🇸', 'UY': '🇺🇾', 'Uruguay': '🇺🇾', 'UZ': '🇺🇿', 'Uzbekistan': '🇺🇿',
        'VA': '🇻🇦', 'Holy See (Vatican City State)': '🇻🇦', 'VC': '🇻🇨', 'Saint Vincent and the Grenadines': '🇻🇨', 'VE': '🇻🇪', 'Venezuela, Bolivarian Republic of': '🇻🇪',
        'VG': '🇻🇬', 'Virgin Islands, British': '🇻🇬', 'VI': '🇻🇮', 'Virgin Islands, U.S.': '🇻🇮', 'VN': '🇻🇳', 'Viet Nam': '🇻🇳',
        'VU': '🇻🇺', 'Vanuatu': '🇻🇺', 'WF': '🇼🇫', 'Wallis and Futuna': '🇼🇫', 'WS': '🇼🇸', 'Samoa': '🇼🇸',
        'XK': '🇽🇰', 'Kosovo': '🇽🇰', 'YE': '🇾🇪', 'Yemen': '🇾🇪', 'YT': '🇾🇹', 'Mayotte': '🇾🇹',
        'ZA': '🇿🇦', 'South Africa': '🇿🇦', 'ZM': '🇿🇲', 'Zambia': '🇿🇲', 'ZW': '🇿🇼', 'Palestine': '🇵🇸'
      };
      if (!country) return '🌐';
      const normalizedCountry = String(country).trim();
      for (const key in flagMap) {
        if (key.toLowerCase() === normalizedCountry.toLowerCase()) {
          return flagMap[key];
        }
      }
      return '🌐';
    }

    const getResultsBtn = document.getElementById('getResultsBtn');
    const supportBtn = document.getElementById('supportBtn');
    const usernameInputGlobal = document.getElementById('username');

    if (getResultsBtn) getResultsBtn.addEventListener('click', lookupUser);
    if (supportBtn) supportBtn.addEventListener('click', () => window.open('https://ko-fi.com/moroccan', '_blank'));
    if (usernameInputGlobal) {
      usernameInputGlobal.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
          e.preventDefault();
          lookupUser();
        }
      });
    }

    function createMessage(text, type = 'error') {
        const bgColor = type === 'success' ? 'bg-green-500/80' : 'bg-red-500/80';
        return `<div class="glass-card p-4 text-center ${bgColor} text-white font-semibold">${text}</div>`;
    }
    
    function lookupUser() {
      const resultDiv = document.getElementById('result');
      const username = usernameInputGlobal ? usernameInputGlobal.value.trim() : '';

      if (!username) {
        if(resultDiv) resultDiv.innerHTML = createMessage('Please enter a valid TikTok username.');
        return;
      }

      if (typeof API_CONFIG === 'undefined' || typeof getApiUrl === 'undefined') {
        if(resultDiv) resultDiv.innerHTML = createMessage('API configuration error. Please contact support.');
        return;
      }

      getResultsBtn.disabled = true;
      getResultsBtn.innerHTML = `<svg class="loading-spinner h-5 w-5 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;

      const apiUrl = getApiUrl(username);
      if (!apiUrl) {
        if(resultDiv) resultDiv.innerHTML = createMessage('Could not construct API URL.');
        getResultsBtn.disabled = false;
        getResultsBtn.innerText = 'Get Profile Details';
        return;
      }

      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            return response.text().then(text => {
                let errorMsg = `API Error: Status ${response.status}`;
                if (response.status === 429) errorMsg = 'Rate limit exceeded. Try again later.';
                else if (response.status === 404) errorMsg = 'User not found or API endpoint issue.';
                else { try { const d = JSON.parse(text); errorMsg = d.message || d.error || text; } catch (e) { errorMsg = text || errorMsg; }}
                throw new Error(errorMsg);
            });
          }
          return response.json();
        })
        .then(data => {
          const apiProfile = data.profile || data;

          if (apiProfile && typeof apiProfile === 'object' && Object.keys(apiProfile).length > 0) {
            const sanitize = str => (typeof str !== 'string') ? (str ?? '') : str.replace(/</g, "&lt;").replace(/>/g, "&gt;");
            
            let foundProfilePhotoUrl = '';
            const avatarKeys = ['Profile Photo', 'Avatar URL', 'avatar_url', 'avatarUrl', 'picture', 'profileImageUrl', 'profile_pic_url', 'profile_image_url', 'avatar', 'Avatar', 'profile_picture', 'photo_url', 'user_avatar'];
            for (const key of avatarKeys) {
                if (apiProfile[key] && typeof apiProfile[key] === 'string' && apiProfile[key].trim() !== '') {
                    foundProfilePhotoUrl = apiProfile[key];
                    break;
                }
            }
            const profilePhoto = sanitize(foundProfilePhotoUrl);
            
            let rawUsernameFromAPI = apiProfile.Username || apiProfile.username || apiProfile.user_name || apiProfile.unique_id || username;
            if (typeof rawUsernameFromAPI === 'string' && rawUsernameFromAPI.startsWith('@')) {
                rawUsernameFromAPI = rawUsernameFromAPI.substring(1);
            }
            const displayUsername = sanitize(rawUsernameFromAPI);
            const displayNickname = sanitize(apiProfile.Nickname || apiProfile.nickname || apiProfile.name || apiProfile.display_name || apiProfile.user_display_name || displayUsername);

            // --- DATA HANDLING ---
            const details = {};
            let bio = '';
            
            const bioKeys = ['bio', 'description', 'signature'];
            const ignoredKeys = ['nickname','username','name','display_name','user_name','unique_id', 'secuid', 'lastmodified', 'follower', 'following', 'like', 'digg', 'video', 'heart', 'website', 'bio_link', 'url', ...avatarKeys.map(k => k.toLowerCase())];

            for (const key in apiProfile) {
                if (!Object.hasOwnProperty.call(apiProfile, key) || apiProfile[key] == null || String(apiProfile[key]).trim() === '') continue;
                const lowerKey = key.toLowerCase();
                if (bioKeys.some(bioKey => lowerKey.includes(bioKey))) {
                    bio = apiProfile[key];
                } else if (!ignoredKeys.some(ignoredKey => lowerKey.includes(ignoredKey))) {
                    details[key] = apiProfile[key];
                }
            }
            
            // --- BUILD DETAILS HTML ---
            let detailsHtml = '';
            if (Object.keys(details).length > 0) {
                detailsHtml += '<div class="grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-4">';
                for (const key in details) {
                    let value = details[key];
                    let displayKey = key.replace(/([A-Z])/g, ' $1').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()).trim();
                    let valueHtml;

                    if (['country', 'region', 'location'].some(k => key.toLowerCase().includes(k))) {
                        valueHtml = `${getCountryFlag(value)} ${sanitize(String(value)) || 'N/A'}`;
                    } else if (typeof value === 'boolean') {
                        valueHtml = value ? '<span class="font-semibold text-green-500">Yes</span>' : '<span class="font-semibold text-red-500">No</span>';
                    } else if (typeof value === 'string' && value.startsWith('http')) {
                        valueHtml = `<a href="${sanitize(value)}" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:underline break-all">${sanitize(value)}</a>`;
                    } else {
                        valueHtml = sanitize(String(value)) || 'N/A';
                    }
                    detailsHtml += `<div class="text-sm"><div class="font-semibold" style="color: var(--text-primary);">${displayKey}</div><div class="font-medium" style="color: var(--text-secondary);">${valueHtml}</div></div>`;
                }
                detailsHtml += '</div>';
            }
            
            // --- BUILD DOWNLOAD BUTTON HTML ---
            let downloadButtonHtml = '';
            if(profilePhoto) {
                downloadButtonHtml = `
                    <a href="${profilePhoto}" download="${displayUsername}_avatar" rel="noopener noreferrer" class="flex items-center gap-1.5 btn-3d px-3 py-1.5 text-xs font-bold text-white rounded-full bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400 shadow-lg">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        <span>Download Avatar</span>
                    </a>`;
            }

            // --- BUILD BIO HTML ---
            let bioHtml = '';
            if (bio) {
                 const urlRegex = /(https?:\/\/[^\s]+)/g;
                 const sanitizedBio = sanitize(String(bio)).replace(urlRegex, '<a href="$&" target="_blank" rel="noopener noreferrer" class="text-cyan-400 hover:underline">$&</a>');
                bioHtml = `<div class="mt-6 pt-4 border-t border-white/10 dark:border-black/20 text-left">
                    <h4 class="font-bold text-md mb-2" style="color: var(--text-primary);">Bio</h4>
                    <p class="text-sm whitespace-pre-wrap" style="color: var(--text-secondary);">${sanitizedBio.replace(/\n/g, '<br>')}</p>
                </div>`;
            }

            const formattedData = `
              <article class="glass-card p-6" aria-labelledby="profile-card-heading-${displayUsername}">
                <div class="flex flex-row items-center gap-5">
                   <div class="relative flex-shrink-0">
                      <img src="${profilePhoto}" alt="Profile photo of ${displayNickname}" class="h-20 w-20 sm:h-24 sm:w-24 rounded-full object-cover border-4 border-white/50 dark:border-white/10 shadow-lg" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                      <div class="h-20 w-20 sm:h-24 sm:w-24 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center" style="display:none;">
                        <svg class="h-12 w-12 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><path d="M24 20.993V24H0v-2.996A14.977 14.977 0 0112.004 15c4.904 0 9.26 2.354 11.996 5.993zM16.002 8.998a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                      </div>
                    </div>
                    <div class="text-left flex-grow">
                        <h3 class="text-xl sm:text-2xl font-bold" style="color: var(--text-primary);">${displayNickname}</h3>
                        <div class="flex items-center gap-3 mt-1">
                            <p class="text-sm sm:text-md font-mono" style="color: var(--text-secondary);">${displayUsername.startsWith('@') ? displayUsername : '@' + displayUsername}</p>
                            ${downloadButtonHtml}
                        </div>
                    </div>
                </div>
                ${detailsHtml ? `<div class="my-6 h-px bg-white/10 dark:bg-black/20"></div>${detailsHtml}` : ''}
                ${bioHtml}
              </article>`;

            if(resultDiv) resultDiv.innerHTML = formattedData;
          } else {
            if(resultDiv) resultDiv.innerHTML = createMessage(`Profile data not found or is incomplete for '${sanitize(username)}'.`);
          }
        })
        .catch(error => {
          if(resultDiv) resultDiv.innerHTML = createMessage(`Error: ${error.message || 'Failed to fetch profile data'}.`);
        })
        .finally(() => {
          getResultsBtn.disabled = false;
          getResultsBtn.innerText = 'Get Profile Details';
        });
    }

  </script>
</body>
</html>
